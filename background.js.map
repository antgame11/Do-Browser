{"version":3,"file":"background.js","sources":["../../../../node_modules/.pnpm/wxt@0.20.11_@types+node@20.17.16_less@4.2.0_lightningcss@1.29.2_rollup@4.24.0_sass@1.80.6_webpack-sources@3.2.3/node_modules/wxt/dist/utils/define-background.mjs","../../src/entrypoints/background.ts","../../../../node_modules/.pnpm/@wxt-dev+browser@0.1.4/node_modules/@wxt-dev/browser/src/index.mjs"],"sourcesContent":["export function defineBackground(arg) {\n  if (arg == null || typeof arg === \"function\") return { main: arg };\n  return arg;\n}\n","export default defineBackground(() => {\n  chrome.action.setPopup({ popup: \"\" });\n\n  chrome.runtime.onInstalled.addListener((details) => {\n    // Don't show the getting started page for evals.\n    if (import.meta.env.WXT_MOCK_AUTH === \"true\") {\n      return;\n    }\n\n    if (details.reason === \"install\") {\n      chrome.tabs.create({\n        url: `${import.meta.env.WXT_BASE_URL}/getting-started`,\n      });\n    }\n  });\n\n  let isOpen = false;\n  let tabConnection: chrome.runtime.Port | null = null;\n  let isArc = false;\n\n  let pendingRequests: { action: string }[] = [];\n\n  async function openForBrowser(tabId: number) {\n    if (isArc) {\n      chrome.action.setPopup({ popup: \"popup.html\" });\n      await chrome.action.openPopup();\n    } else {\n      await chrome.sidePanel.open({ tabId });\n    }\n  }\n\n  function sendToConnection(message: { action: string }) {\n    if (tabConnection) {\n      tabConnection.postMessage(message);\n    } else {\n      pendingRequests.push(message);\n    }\n  }\n\n  chrome.runtime.onConnect.addListener((connection) => {\n    tabConnection = connection;\n    if (connection.name === \"sidebar\") {\n      for (const pendingRequest of pendingRequests) {\n        sendToConnection(pendingRequest);\n      }\n      pendingRequests = [];\n      isOpen = true;\n      connection.onDisconnect.addListener(async () => {\n        tabConnection = null;\n        isOpen = false;\n        // Get the active tab\n        const tabs = await chrome.tabs.query({});\n        for (const tab of tabs) {\n          try {\n            try {\n              await chrome.debugger.detach({ tabId: tab.id });\n            } catch (e) {}\n            await chrome.tabs.sendMessage(tab.id!, {\n              action: \"simulateClick\",\n              box: null,\n            });\n          } catch (error) {\n            console.error(\"Error sending simulateClick:\", error);\n          }\n        }\n      });\n    }\n  });\n\n  chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.type === \"getCurrentTabId\") {\n      sendResponse({ tabId: sender.tab?.id });\n    } else if (message.type === \"open_side_panel\") {\n      openForBrowser(sender.tab?.id!);\n    } else if (message.type === \"browserIsArc\") {\n      isArc = true;\n      chrome.action.setPopup({ popup: \"popup/index.html\" });\n    }\n    return true;\n  });\n\n  chrome.commands.onCommand.addListener(function (command, tab) {\n    if (command === \"toggle-sidebar\") {\n      if (isOpen) {\n        tabConnection?.postMessage({ action: \"close\" });\n      } else {\n        openForBrowser(tab!.id!);\n      }\n    }\n  });\n\n  chrome.action.onClicked.addListener(async (tab) => {\n    openForBrowser(tab.id!);\n  });\n\n  let omniboxTabId: number | undefined = undefined;\n\n  chrome.omnibox.onInputStarted.addListener(async () => {\n    const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n    omniboxTabId = tabs[0]?.id;\n    // TODO There might be a race condition here\n    if (\n      tabs[0]?.url?.startsWith(\"chrome\") ||\n      tabs[0]?.url?.includes(\"chromewebstore.google.com\") ||\n      tabs[0]?.url?.startsWith(\"edge://\")\n    ) {\n      await chrome.tabs.update(omniboxTabId!, { url: \"about:blank\" });\n    }\n  });\n\n  chrome.omnibox.onInputChanged.addListener(async (text, suggest) => {\n    const history = await chrome.storage.local.get(\"messageHistory\");\n    const messageHistory: string[] = history.messageHistory || [];\n\n    // Filter history items that include the input text\n    const suggestions = messageHistory\n      .filter((msg) => msg.toLowerCase().includes(text.toLowerCase()))\n      .map((msg) => ({\n        content: msg,\n        description: msg,\n      }));\n\n    suggest(suggestions);\n  });\n\n  chrome.omnibox.onInputEntered.addListener((text) => {\n    chrome.sidePanel.open({ tabId: omniboxTabId! });\n    sendToConnection({ action: \"request\", msg: text } as any);\n  });\n});\n","// #region snippet\nexport const browser = globalThis.browser?.runtime?.id\n  ? globalThis.browser\n  : globalThis.chrome;\n// #endregion snippet\n"],"names":["defineBackground","arg","definition","details","isOpen","tabConnection","isArc","pendingRequests","openForBrowser","tabId","sendToConnection","message","connection","pendingRequest","tabs","tab","error","sender","sendResponse","_a","_b","command","omniboxTabId","_c","_e","_d","_g","_f","text","suggest","suggestions","msg"],"mappings":"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","x_google_ignoreList":[0,2]}